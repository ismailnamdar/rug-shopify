<script src="{{ 'tinybind.js' | asset_url }}"></script>
{% assign raddish_plus = all_products["raddish-plus"] %}
{% assign raddish_plus_id = raddish_plus.selected_or_first_available_variant.id %}
{% assign raddish_plus_sub_id = raddish_plus.metafields.subscription.id %}
{% assign steps = section.blocks | where: "type", "steps" | first | map: "settings" | first %}
{% assign total_steps = 4 %}

{% if template.suffix == "subscription-builder" %}
<div id="subscription-builder-widget" class="subscription-builder" section-id="{{ section.id }}">
  {% render "subscription-progress-bar", steps: steps, total_steps: total_steps %}
  <div class="subscription-progress__container-desktop">
    <div class="subscription-builder__steps" rv-data-test="state.activeStep" rv-data-test="state.activeStep | minus 1 | times 25" rv-style="state.activeStep | minus 1 | times -25  | append '%)' | prepend 'translateX(' | style 'transform'">
      {% for i in (1..total_steps) %}
        {% capture key %}subscription-builder--step-{{i}}{% endcapture %}
        {% include key, steps: steps, section: section %}
      {% endfor %}
      {% comment %}
    {% render 'subscription-builder--step-1', steps: steps, section: section %}
    {% render 'subscription-builder--step-2', steps: steps, section: section %}
    {% render 'subscription-builder--step-3', steps: steps, section: section %}
    {% render 'subscription-builder--step-4', steps: steps, section: section %}
      {%  endcomment %}
    </div>
  </div>
  {% render "subscription-modal" %}
  <div>

  </div>
  <script type="application/json" data-plans>
    {% assign col = collections[section.settings.plans_collection] %}
    [
    {% for product in col.products %}
      {
        "sku": {{product.selected_or_first_available_variant.sku | json }},
        "id": {{product.selected_or_first_available_variant.id | json }},
        "product_id": {{product.id | json }},
        "type": {{product.handle | handle | json }},
        "club": {{product.metafields.subscription.type | json }},
        {% assign parts = product.type | downcase | split: "+" %}
        "siblings": {{product.metafields.subscription.siblings | json }},
        "subscription_id": "{{product.metafields.subscription.subscription_id | default: "" }}",
        "length": {{product.metafields.subscription.length | json }},
        "discount_product_id": {{product.metafields.subscriptions.discount_product_id | default: "2" | json }},
        "handle": {{product.handle | json }},
        "subscription_item": "{{product.metafields.subscription.item}}",
        "plan": "{{product.metafields.subscription.plan | default: "?"}}",
        "free_product": "{{product.metafields.subscription.free_product | split: "/" | last }}",
        "free_product_2": "{{product.metafields.subscription.free_product_2 | split: "/" | last }}",
        "free_product_3": "{{product.metafields.subscription.free_product_3 | split: "/" | last }}",
        "selling_plan_id": "{{ product.selling_plan_groups[0].selling_plans[0].id }}"
      }
      {% unless forloop.last %},{% endunless %}
    {% endfor %}
    ]
  </script>
</div>
<div class="hidden hide">
  {% render "gift-options", steps: steps %}
</div>
{% else %}

<div id="subscription-builder-widget"></div>

{% endif %}

<script>
  class SubscriptionBuilder {
    constructor(container) {
      this.$container = $(container);
      this.selectors = {
        additionalModalContent: ".additional-content-modal .content > .modal-content",
        cartItems: "#shopify-section-ajax-cart cart-items",
        cartTotals: "#shopify-section-ajax-cart .order__totals",
        checkoutButtons: "#main-cart-footer",
        noteContainer: "#ajax-cart .ajax-cart__note-container",
        closeNote: "#step-4-note .ajax-cart__note-container .gift-note-close",
        openNote: "#step-4-summary .gift-message-button",
        cancelNote: "#step-4-note #button-cancel-note",
        editNote: "#step-4-summary #gift-message-edit",
        deleteNote: "#step-4-summary #gift-message-delete",
        saveNote: "#step-4-note #button-save-note",
        shareTrackingContainer: "#ajax-cart .ajax-cart__share-tracking-container",
        closeShareTracking: "#step-4-share-tracking-note .ajax-cart__share-tracking-container .share-tracking-close",
        openShareTracking: "#step-4-summary .share-tracking-button",
        cancelShareTracking: "#step-4-share-tracking-note #button-cancel-share-tracking",
        editShareTracking: "#step-4-summary #share-tracking-edit",
        deleteShareTracking: "#step-4-summary #share-tracking-delete",
        saveShareTracking: "#step-4-share-tracking-note #button-save-share-tracking",
        subscriptionSummary: "#step-4-summary",
        subscriptionTotals: ".subscription-step--4 .order__totals",
        step4Note: "#step-4-note",
        step4ShareTrackingNote: "#step-4-share-tracking-note",
        subscriptionSummaryUpsells: "#step-4-upsells",
        subscriptionSummaryButtons: "#step-4-buttons",
        subscriptionSummaryNote: "#step-4-note",
        subscriptionSummaryShareTracking: "#step-4-share-tracking-note",
        reviewButton: '.subscription-step--3 .button-checkout'
      }
      this.customer = {
        email: {{customer.email | json }},
        first_name: {{customer.first_name | json }},
        last_name: {{customer.last_name | json }}
      }
      this.data = {
        collections: null
      }
      this.cache = {}
      this.state = {
        lastStepStateChanged: false,
        touched: false,
        completedSteps: [1],
        activeStep: 1,
        modalOpen: false,
        buyNowShipLater: false,
        shipNow: true,
        shipDecember: false,
        shipJanuary: false,
        subscription: {
          club: "",
          plan_length: '',
        },
        parent: {
          first_name: '',
          last_name: '',
          email: ''
        },
        note: {{cart.note | json }},
        shareTracking: "",
        extraItems: {
          'sibling_bundle': '0'
        }
      }
      this.methods = {
        changeStep: this.changeStep.bind(this),
        goBack: this.goBack.bind(this),
        goToFirstStep: this.goToFirstStep.bind(this),
        updateSubscription: this.updateSubscription.bind(this),
        updateSubscriptionProperty: this.updateSubscriptionProperty.bind(this),
        updateBuyNowShipLater: this.updateBuyNowShipLater.bind(this),
        updateParentProperty: this.updateParentProperty.bind(this),
        updateShareSharing: this.updateShareSharing.bind(this),
        openAdditionalContent: this.openAdditionalContent.bind(this),
        closeModal: this.closeModal.bind(this),
        addUpsellToSubscription: this.addUpsellToSubscription.bind(this),
        removeUpsellFromSubscription: this.removeUpsellFromSubscription.bind(this),
        changeNote: this.changeNote.bind(this),
        changeBnsl: this.changeBnsl.bind(this),
        addToCart: this.addToCart.bind(this),
        openModalOnLastStep: this.openModalOnLastStep.bind(this),
        openShareTrackingModalOnLastStep: this.openShareTrackingModalOnLastStep.bind(this)
      }
      this.ajaxCart = document.querySelector('ajax-cart');

      this.loadData();
      this.setupFormatters();
      this.setSubscription.bind(this);
      // Uncomment line below to reenable setting stored subscription on page load:
      this.setSubscription(); 
      this.bindState();
      this.updateSubscriptionProperty.bind(this)
      this.sendKlaviyoAbandonedEvent.bind(this)
      this.addEventListener.bind(this)
      this.setState.bind(this)
      this.addEventListener();
      this.bindAbandonedEvents();
      // if(this.customer.email) this.bindAbandonedEvents();
      // this.setState = this.setState
    }
    bindAbandonedEvents() {
      var self = this
      console.log('binding abandoned events')
      $('a').on('click', function(e){
        // e.preventDefault();
        // e.stopPropagation()
        let url = this.href;
        if(url && url.indexOf("checkout") == -1 ) {
          self.sendKlaviyoAbandonedEvent("page_change");
        }
      })
      window.onbeforeunload = function (event) {
          console.log('before unload ', event, typeof event)
          self.sendKlaviyoAbandonedEvent("browser_closed");
      };
    }

    sendKlaviyoAbandonedEvent(type) {
      console.log('sending Klaviyo event', this.state.touched, this.customer)
      if(this.state.touched && "_learnq" in window) {
        if(this.customer.email) {
          _learnq.push(['identify', {
            '$email' : this.customer.email,
            '$first_name' : this.customer.first_name,
            '$last_name' : this.customer.last_name,
          }]);
        }
        const payload = {
          '$type': type,
          '$step': this.state.activeStep,
          '$club' : this.state.subscription.club,
          '$term' : this.state.subscription.plan_length,
          '$url': window.location.href,
          '$subscription_builder_url': 'https://raddishkids.com/pages/cooking-kits?' + window.location.href.split("?").pop(),
          '$options': {
            '$apron': this.state.extraItems[39874322727071],
            '$cookbook': this.state.extraItems[10117822469],
            '$bundle': this.state.extraItems.sibling_bundle
          }
        }
        const result = _learnq.push(['track', 'Subscription Builder Abandoned', payload]);
      }
    }

    addEventListener() {
      var self = this;
      $(document).on("click", '[data-learn-more-raddish]', self.openAdditionalContent.bind(self))
      $(document).on("click", this.selectors.closeNote, function() {
        $(self.selectors.step4Note).removeClass("gift-note-open");
      })

      $(document).on("click", this.selectors.cancelNote, function() {
        $(self.selectors.step4Note).removeClass("gift-note-open");
      })

      $(document).on("click", this.selectors.editNote, function() {
        $(self.selectors.step4Note).addClass("gift-note-open");
      })

      $(document).on("click", this.selectors.openNote, function() {
        $(self.selectors.step4Note).addClass("gift-note-open");
      })

      $(document).on("click", this.selectors.saveNote, function() {
        self.state.note = '';
        $(self.selectors.step4Note).removeClass("gift-note-open");
      })
      
      $(document).on("click", this.selectors.saveShareTracking, function() {
        const noteValue = $("#step-4-note #share-tracking-note").val();
        self.state.note = noteValue;
        $(self.selectors.step4ShareTrackingNote).removeClass("share-tracking-open");
      })

      $(document).on("click", this.selectors.closeShareTracking, function() {
        $(self.selectors.step4ShareTrackingNote).removeClass("share-tracking-open");
      })

      $(document).on("click", this.selectors.cancelShareTracking, function() {
        $(self.selectors.step4ShareTrackingNote).removeClass("share-tracking-open");
      })

      $(document).on("click", this.selectors.editShareTracking, function() {
        $(self.selectors.step4ShareTrackingNote).addClass("share-tracking-open");
      })

      console.log('open', this.selectors.openShareTracking)
      $(document).on("click", this.selectors.openShareTracking, function() {
        console.log('share tracking open')
        $(self.selectors.step4ShareTrackingNote).addClass("share-tracking-open");
      })

      $(document).on("click", this.selectors.saveShareTracking, function() {
        self.state.shareTracking = '';
      })
      
      $(document).on("click", this.selectors.saveShareTracking, function() {
        const noteValue = $("#step-4-note #share-tracking-note").val();
        self.state.shareTracking = noteValue;
        $(self.selectors.step4ShareTrackingNote).removeClass("share-tracking-open");
      })
    }

    removeUpsellFromSubscription(itemId) {
      this.state.extraItems[`${itemId}`]--;
      this.encodeSubscriptionData();
      this.checkSteps();
    }

    encodeSubscriptionData(relative = false) {
      this.state.touched = true;
      var data = {
        subscription: this.state.subscription,
        completedSteps: this.state.completedSteps,
        extraItems: this.state.extraItems,
        note: this.state.note,
        parent: this.state.parent,
        activeStep: this.state.activeStep,
        buyNowShipLater: this.state.buyNowShipLater,
        shipNow: this.state.shipNow,
        shipDecember: this.state.shipDecember,
        shipJanuary: this.state.shipJanuary
      }
      const encodedData = btoa(JSON.stringify(data))
      if ('URLSearchParams' in window) {
        var searchParams = new URLSearchParams(window.location.search);
        searchParams.set("subscription", encodedData);
        if(relative) {
          searchParams.delete("club");
        }
        var newRelativePathQuery = window.location.pathname + '?' + searchParams.toString();
        history.pushState(null, '', newRelativePathQuery);
      }
      try {
        localStorage.setItem('subscription', encodedData);
      } catch (error) {
        console.log(error)        
      }
    }

    setSubscription() {
      console.log('setting sub')
      if ('URLSearchParams' in window) {
        var searchParams = new URLSearchParams(window.location.search);
        var encodedSubscription = searchParams.get("subscription");
        var club = searchParams.get("club");
        var autoselectedClub = "{{section.settings.autoselected_club}}";
        if(!club && autoselectedClub != "none") {
          club = autoselectedClub;
        }
        var self = this
        if(club) {
          this.state = {
            ...this.state,
              subscription: {
              club: club.toUpperCase(),
              plan_length: '',
            },
            extraItems: {
              'sibling_bundle': '0'
            },
            completedSteps: [1],
            activeStep: 1
          }
          setTimeout(function() {
            self.changeStep(2);
          }, 500)
          this.encodeSubscriptionData(true);
        } else {
          // TODO: open this if you want to have the save state of the current sub
          {% comment %} if(!encodedSubscription){
            try {
                encodedSubscription = localStorage.getItem('subscription');
            } catch (error) {
              console.log(error);                
            }
          }
          if(encodedSubscription) {
            try {
              var data = {}
              try {
                data = JSON.parse(atob(encodedSubscription))
                console.log(data)
              } catch (error) {
                console.log(error);
              }
              this.state = {
                ...this.state,
                ...data
              }
              console.log('this new state', this.state)
              if(data.completedSteps.indexOf(4) > -1) {
                this.insertCartIntoSummary();
              }
            } catch (error) {
              console.log(error)
            }
          } {% endcomment %}
        }
        // var autoselectedClub = "{{section.settings.autoselected_club}}";
        // console.log({autoselectedClub})
        // if(autoselectedClub != "none") {
        //   this.state = {
        //     ...this.state,
        //     subscription: {
        //       ...this.state.subscription,
        //       club: autoselectedClub
        //     }
        //   }
        //   console.log('state should be udated')
        // }
        // // window.location.search = searchParams.toString();
        // var newRelativePathQuery = window.location.pathname + '?' + searchParams.toString();
        // history.pushState(null, '', newRelativePathQuery);
      }
    }

    generateHash(length) {
      var result = "";
      var timestamp = Date.now();
      var characters =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      var charactersLength = characters.length;
      for (var i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
      }
      result += timestamp;
      return result;
    }

    getLandingPage() {
      switch(window.location.pathname) {
        case '/pages/kids-cooking-kits': return 'cooking-lp';
        case '/pages/kids-baking-kits': return 'baking-lp';
        case '/pages/global-cooking-kits': return 'global-lp';
        case '/pages/cooking-kits': return 'subscription-builder-lp';
        default: return 'other'
      }
    }

    getSBOProp() {
      const [date, time] = new Date().toLocaleString("en-US", {timeZone: "America/Los_Angeles"}).split(", ")
      var [month, day, year] = date.split("/").map(s => parseInt(s))
      if(day >= 18) {
        month = month + 1
      }
      if(month == 13) {
        month = 1;
        year = year + 1.
      }
      var stringMonth = ""; 
      switch(month) {
        case 1: stringMonth = "Jan"; break;
        case 2: stringMonth = "Feb"; break;
        case 3: stringMonth = "Mar"; break;
        case 4: stringMonth = "Apr"; break;
        case 5: stringMonth = "May"; break;
        case 6: stringMonth = "Jun"; break;
        case 7: stringMonth = "Jul"; break;
        case 8: stringMonth = "Aug"; break;
        case 9: stringMonth = "Sep"; break;
        case 10: stringMonth = "Oct"; break;
        case 11: stringMonth = "Nov"; break;
        case 12: stringMonth = "Dec"; break;
      }
      return `_SBO_${stringMonth}${year.toString().slice(2,4)}`;
    }

    getSelectedSubscription() {
      var self = this
      return this.data.collections.find(col => {
        return col.club === self.state.subscription.club && col.siblings == self.state.extraItems.sibling_bundle && col.length == self.state.subscription.plan_length
      })
    }

    proceedToCheckout() {
      event.preventDefault()
      event.stopPropagation()
      if(this.state.lastStepStateChanged) {
        this.addToCart().then()
      } else {
      
      }
    }

    addToCart() {
      $(this.selectors.reviewButton).addClass("loading")
      const timestamp = new Date().getTime()
      const subscription = this.getSelectedSubscription();
      // return
      const hash = this.generateHash(10);
      var itemsToAdd = [];
      // return
      // var siblingsCount = this.state.extraItems[this.settings.siblingProductId] || 0;
      // var selectedPlan = this.plans[plan - 1];
      // var productId = selectedPlan.prod_id_siblings[siblingsCount];
      var properties = {
        // _activation_date: new Date().toLocaleString("en-US", {timeZone: "America/Los_Angeles"}).split(",")[0],
        _membership_timestamp: timestamp,
        // _subscription_id: subscription.subscription_id,
        _subscription_hash: hash,
        // _subscription_item: subscription.subscription_item,
        _plan: subscription.plan,
        _landing_page: this.getLandingPage(),
        ...(this.state.shipDecember ? { '_BNSL_Dec23': "True", "Ship": "December"} : {}),
        ...(this.state.shipJanuary ? { '_BNSL_Jan24': "True", "Ship": "January" } : {}),
        ...(this.state.sbo ? { [`${this.getSBOProp()}`]: "True" } : {}),
        ...(this.state.parent.first_name ? {_parent_first_name: this.state.parent.first_name} : {}),
        ...(this.state.parent.last_name ? {_parent_last_name: this.state.parent.last_name} : {})
      }
      
      var planItem =   {
        id: subscription.id,
        quantity: 1,
        properties: properties,
        selling_plan: subscription.selling_plan_id
      }
      itemsToAdd.push(planItem);

      // Add extra items
      var index = 0;
      for (const variantId in this.state.extraItems) {
        var key = `option${index}`;
        index++;
        if(!this.state.extraItems[variantId]) continue;
        if (variantId == 'sibling_bundle') continue;
        itemsToAdd.push({
          id: variantId,
          quantity: this.state.extraItems[variantId],
          properties: {
            [`_${key}`]: "true",
            _membership_timestamp: timestamp,
          }
        })
      }
      // Add free product
      if(subscription.free_product) {
        itemsToAdd.push({
          id: subscription.free_product,
          quantity: 1, 
          properties: {
            _is_gift_with_purchase: true,
            _membership_timestamp: timestamp,
            _gift_product: true,
            _required_products: subscription.product_id
          }
        })
      }

      if(subscription.free_product_2) {
        itemsToAdd.push({
          id: subscription.free_product_2,
          quantity: 1, 
          properties: {
            _is_gift_with_purchase: true,
            _membership_timestamp: timestamp,
            _gift_product: true,
            _required_products: subscription.product_id
          }
        })
      }

      if(subscription.free_product_3) {
        itemsToAdd.push({
          id: subscription.free_product_3,
          quantity: 1, 
          properties: {
            _is_gift_with_purchase: true,
            _membership_timestamp: timestamp,
            _gift_product: true,
            _required_products: subscription.product_id
          }
        })
      }

      var self = this;

      if (this.state.note != '') {
        CartJS.setNote(this.state.note);
      }
      var totalNewItemsCount = itemsToAdd.length;
      var currentItemsCount = CartJS.cart.item_count;
      CartJS.addItems(itemsToAdd, {
        "success": function(cartResponse) {
          fetch('/?sections=ajax-cart,cart-upsells')
            .then(response => response.json())
            .then((response) => {
              console.log('done',self.state.lastStepStateChanged)

              if(self.state.lastStepStateChanged) {
                self.reChargeProcessCart()
              } else {
                self.ajaxCart.renderContents({
                  sections: {
                    'ajax-cart': response['ajax-cart'],
                    'selector': '#ajax-cart'
                  }
                }, false);
                self.insertCartIntoSummary();
                self.insertUpsellsIntoSummary(response['cart-upsells']);
                setTimeout(function() {
                  self.changeStep(4);
                  self.encodeSubscriptionData()
                }, 200);
                var currVal = $("#cart-icon-bubble-mobile span").text();
                var newVal =CartJS.cart.item_count;
                $("#cart-icon-bubble-mobile span").text(newVal);
                $("#cart-icon-bubble span").text(newVal);
                $(self.selectors.reviewButton).removeClass("loading")
              }
            })

        },
        "error": function(response) {
          console.log('error', response)
        }
      })
    }
    
    reChargeProcessCart() {
      window.location.href = '/checkout'
      return
      var token
      function get_cookie(name){ return( document.cookie.match('(^|; )'+name+'=([^;]*)')||0 )[2] }
      do { 
        token=get_cookie('cart');
      } while(token == undefined);	
      var myshopify_domain='{{ shop.permanent_domain }}'
      try { var ga_linker = ga.getAll()[0].get('linkerParam') } catch(err) { var ga_linker ='' }
      var checkout_url= "https://checkout.raddishkids.com/r/checkout?myshopify_domain="+myshopify_domain+"&cart_token="+token+"&"+ga_linker;
      window.location.href = checkout_url
    }

    changeNote(event) {
      this.state.note = event.target.value
      this.encodeSubscriptionData()
    }

    changeBnsl(event) {
      console.log(event.target.id)
      switch(event.target.id) {
        case 'ship-now': {
          this.state.shipNow = true
          this.state.shipDecember = false
          this.state.shipJanuary = false
          break;
        }
        case 'ship-december': {
          this.state.shipNow = false
          this.state.shipDecember = true
          this.state.shipJanuary = false
          break;
        }
        case 'ship-january': {
          this.state.shipNow = false
          this.state.shipDecember = false
          this.state.shipJanuary = true
          break;
        }
      }
    }

    addUpsellToSubscription(itemId) {
      this.state.extraItems[`${itemId}`] || this.state.extraItems[`${itemId}`] > 0
              ? this.state.extraItems[`${itemId}`]++ 
              : this.state.extraItems[`${itemId}`] = 1
      this.encodeSubscriptionData()
      this.checkSteps()
    }

    loadData() {
      this.data.collections = JSON.parse($("[data-plans]").html());
    }

    
    bindState() {
      tinybind.bind(this.$container, {
        state: this.state,
        methods: this.methods
      });
    }

    openModal() {
      this.state.modalOpen = true
      document.body.classList.add("subscription-modal-open");
    }



    closeModal(revertState = false) {
      this.state.modalOpen = false
      document.body.classList.remove("subscription-modal-open");
      if(revertState === true) {
        const oldState = JSON.parse(JSON.stringify(this.cache.state));
        this.state.parent = oldState.parent
        this.state.note = oldState.note
      } else {
        this.encodeSubscriptionData()
      }
    }

    goBack(stepIndex) {
      this.changeStep( this.state.activeStep - 1)
    }

    goToFirstStep() {
      this.changeStep(1)
    }

    changeStep(stepIndex) {
      if(stepIndex <= 4) {
        this.state.activeStep = stepIndex;
        if(this.state.completedSteps.indexOf(stepIndex) == -1) {
          this.state.completedSteps.push(stepIndex)
        }
        var currentStepHeight = $(`.subscription-step--${stepIndex}`).height();
        if(stepIndex == 4) {
          currentStepHeight = currentStepHeight + 150
        }
        $(".subscription-progress__container-desktop").css("max-height", currentStepHeight + "px")
        const yOffset = -150; 
        if(document.getElementById("subscription-builder")) {
          const element = document.getElementById("MainContent");
          const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
          window.scrollTo({top: y, behavior: 'smooth'});        
        }

      }
    }

    insertCartIntoSummary() {
      $(this.selectors.subscriptionSummary ).html($( this.selectors.cartItems ).clone())
      $(this.selectors.subscriptionTotals ).html($( this.selectors.cartTotals ).clone())
      $(this.selectors.subscriptionSummaryButtons).html($(this.selectors.checkoutButtons).clone())
      $(this.selectors.subscriptionSummaryNote).html($(this.selectors.noteContainer).clone())
      $(this.selectors.subscriptionSummaryShareTracking).html($(this.selectors.shareTrackingContainer).clone())

      // Add event to plan "Change" button
      const buttonPlanChange = document.getElementById('plan-change-button');
      if (buttonPlanChange) {
        buttonPlanChange.addEventListener('click', this.methods.goToFirstStep);
      }
    }

    insertUpsellsIntoSummary(upsellsHtml) {
      $(this.selectors.subscriptionSummaryUpsells ).html(upsellsHtml)
    }

    openAdditionalContent(event) {
      event.stopPropagation();
      event.preventDefault();
      const html = this.getSection(event.currentTarget.dataset.contentId);
      // console.log(event.currentTarget.dataset.contentId)
      this.insertSectionToModal(html);
      this.initSliders(this.selectors.additionalModalContent)
      this.openModal(true);
      this.cache.state = JSON.parse(JSON.stringify(this.state));
      tinybind.bind($(this.selectors.additionalModalContent), {
        state: this.state,
        methods: this.methods
      });
    }

    getSection(sectionId) {
      const id = `#${sectionId}`
      const $section = $(id);
      if($section.length) {
        return $section.html()
      } else {
        // Fetch via API
      }
    }

    insertSectionToModal(html) {
      $(this.selectors.additionalModalContent).html(html);
    }
    updateParentProperty(property, value) {
      this.state.parent[property] = value
      this.state.lastStepStateChanged = true
      this.encodeSubscriptionData();
    }
    updateShareSharing(value) {
      this.state.shareSharing = value
      this.state.lastStepStateChanged = true
    }
    openModalOnLastStep(event) {
      this.state.lastStepStateChanged = true;
      this.openAdditionalContent(event)
    }
    openShareTrackingModalOnLastStep(event) {
      this.state.lastStepStateChanged = true;
      console.log('opening modal')
    }
    updateBuyNowShipLater(value) {
      if(value) {

      } else {
        this.state.lastStepStateChanged = true
        this.state.shipNow = true
        this.state.shipJanuary = false
        this.state.shipDecember = false
      }
      this.encodeSubscriptionData();
      // this.encodeSubscriptionData()
    }
    updateSubscriptionProperty(property, value) {
      console.log(property, value)
      this.state.subscription = {
        ...this.state.subscription,
        [property]: value
      }
      this.encodeSubscriptionData()
      if(property == 'plan_length' ) {
        this.changeStep(this.state.activeStep)
      }
      console.log(this.state.subscription)
      this.checkSteps();
    }

    checkSteps() {
      // console.log('checking steps')
      if(this.state.completedSteps.indexOf(4) > -1) {
        this.state.completedSteps = [1, 2, 3]
      }
    }

    initSliders(id) {
      $(`${id} .club-main-images`).slick({
        arrows: true,
        dots: false,
        slidesToShow: 1,
        infinite: true,
        slidesToScroll: 1,
        asNavFor: `${id} .club-thumbnails`
      })

      $(`${id} .club-thumbnails`).slick({
        arrows: false,
        asNavFor: `${id} .club-main-images`,
        dots: false,
        infinite: false,
        swipe: true,
        slidesToShow: 6,
        slidesToScroll: 6,
        focusOnSelect: true,
        // centerMode: true,
        // centerPadding: '40px',
        responsive: [
          {
            breakpoint: 749,
            settings: {
              slidesToShow: 4.2,
            }
          }
        ]
      });
    }

    setState(data) {
      // this.state.subscription = data.subscription
      // this.state.completedSteps = data.completedSteps
      // this.state.extraItems = data.extraItems
      // var self = this
      // // this.state.activeStep(1);
      // setTimeout(function() {
      //   self.changeStep(2)
      //   self.encodeSubscriptionData()
      // }, 1200)
      // console.log(this.state)
    }

    updateSubscription(event) {
      this.updateSubscriptionProperty(event.target.name, event.target.value)
      if(event.target.name === 'club') this.state.sbo = event.target.dataset.sboEnabled === "true"

      // this.state.subscription[event.target.name] = event.target.value;
      this.changeStep(this.state.activeStep + 1)
      this.encodeSubscriptionData()
    }

    setupFormatters() {
      tinybind.formatters.args = function(fn) {
        let args = Array.prototype.slice.call(arguments, 1)
        return () => fn.apply(null, args)
      }
      tinybind.formatters.minus = function(e, t) {
        return parseInt(e) - parseInt(t)
      } 
      tinybind.formatters.times = function(e, t) {
        return e * t 
      }
      tinybind.formatters.log = function(value) {
        return value;
      };

      tinybind.formatters.log = function(value) {
        return value;
      };

      tinybind.formatters.size = function(value) {
        // console.log(value.length)
        return value.length;
      };

      tinybind.formatters.style = function(a, b) {
        return b + ': ' + a + ';'
      };

      tinybind.formatters.money = function(value) {
        return (parseFloat(value) / 100).toFixed(2).toString();
      };
      
      tinybind.formatters.not = function(value) {
        return !value;
      };

      tinybind.formatters.and = function(a, b) {
        return a && b;
      };

      tinybind.formatters.eq = function(a, b) {
        return a == b;
      };

      tinybind.formatters.gte = function(a, b) {
        return a >= b;
      };

      tinybind.formatters.or = function(a, b) {
        return a || b;
      };

      tinybind.formatters.gt = function(a, b) {
        return a > b;
      };

      tinybind.formatters.append = function(a, b) {
        return a + b;
      };
      tinybind.formatters.prepend = function(a, b) {
        return b + a;
      };
      tinybind.formatters.includes = function(array, value) {
        if(!array) return false
        return array.indexOf(value) > -1
      };
    }
  }
  document.addEventListener("DOMContentLoaded", function() {
    var theme = window.theme || {}
    {% if false %}
      theme.SubscriptionBuilder = new SubscriptionBuilder("#subscription-builder-widget");
    {% else %}
      fetch('/pages/cooking-kits')
        .then((response) => {
          return response.text();
        })
        .then(function (data) {
          let parser = new DOMParser();
          let docElement = parser.parseFromString(data, 'text/html');
          const source = docElement.getElementById(`subscription-builder-widget`)
          const destination = document.getElementById(`subscription-builder-widget`);
          if (source && destination) { 
            destination.innerHTML = source.innerHTML; 
            theme.SubscriptionBuilder = new SubscriptionBuilder("#subscription-builder-widget");
          }
        })
        .catch(function (err) {
          console.warn('Something went wrong.', err);
        });
    {% endif %}
    // theme.SubscriptionBuilder = new SubscriptionBuilder("#subscription-builder-widget");
  })
</script>

<style>
  .subscription-step.subscription-step--2 h2 {
    margin-bottom: .75rem;
  }
  .step-2__description {
    text-align: center;
    font-size: 14px;
    margin-bottom: 1.25rem;
  }
  [data-option-value="FREE"] { display: none }
  #step-4-buttons {
    margin-top: 1rem;
  }
  .checkbox-row {
    display: flex;
    align-items: center;
  }
  .checkbox-row { position: relative; }
  .checkbox-row input { opacity: 0; position: relative; z-index: 2; left: 3px; cursor: pointer; }
  .checkbox-row img { position: absolute; left: 0; cursor: pointer; }
  .checkbox-row img { width: 20px; height: 20px; margin-right: 10px }
  .checkbox-row .checkbox-img--checked { display: none;}
  .checkbox-row input:checked ~  .checkbox-img { display: none;}
  .checkbox-row input:checked ~  .checkbox-img--checked { display: block;}

  .checkbox-row input[type="checkbox"] { 
    height: 14px; 
    padding: 0; 
    margin-right: 10px; 
    -webkit-appearance: auto; 
    fleX: 0 0 20px;
  }

  .gift-options__parent-details span.checkbox-img--checked {
    border: 2px solid #f3576b;
    width: 20px;
    height: 20px;
    border-radius: 50px;
    position: absolute;
  }

  .gift-options__parent-details span.checkbox-img {
    border: 2px solid #f3576b;
    width: 20px;
    height: 20px;
    border-radius: 50px;
    position: absolute;
  }

  .gift-options__parent-details span.checkbox-img--checked:after {
    content: "";
    position: absolute;
    width: 12px;
    height: 12px;
    background: #f3576b;
    border-radius: 50px;
    left: 2px;
    top: 2px;
  }

  .checkbox-row label {
      font-style: normal;
      font-weight: 400;
      font-size: 16px;
      line-height: 22px;
      color: #4D4D4D;
  }
  .very-top {
    z-index: 89999;
    position: relative;
    background: white;
  }
  #step-4-buttons .cart__footer {
    padding-top: 0px;
  }
  .delete-button {
    text-decoration: underline;
    cursor: pointer;
  }
  .subscription-step--4 {
    position: relative;
  }

  .subscription-step--4 .cart-item {
    margin-bottom: 0 !important;
  }
  .subscription-step--4 .cart__close,
  .subscription-step--4 .cart__close--mobile,
  .subscription-step--4  .cart__threshold-goal,
  .subscription-step--4  .title-wrapper-with-link,
  .subscription-step--4 .quantity__button, 
  .subscription-step--4 .cart-item__actions
  {
    display: none !important;
  }
  .subscription-step--4 .cart-item__link {
    pointer-events: none;
  }
  .subscription-step--4 .cart-item__name {
    pointer-events: none;
  }
  .subscription-step--4 .cart-items.cart-items--ajax .quantity__input {
    text-align: left;
  }
  .club-thumbnails img {
    width: 70px;
    height: 70px;
  }
  .subscription-step--4 .cart-items.cart-items--ajax quantity-input.quantity {
    border: none;
    padding: 0;
  }
  .select-card__icon {
    width: 34px;
    margin-left: 16px;
  }
  .select-card__right {
    display: flex;
    align-items: center;
  }
  /* #subscription-builder {display: none;} */
  .additional-content-modal {
    overflow-y: auto;
  }
  button.btn.btn--add-to-cart {
    width: 100%;
    margin-top: 1rem;
  }

  .club-content {
    padding: 1.6rem 2rem;
  }

  .club-content li:before {
    content: "\2022";
    color: #01BCBE;
    font-weight: bold;
    display: inline-block;
    width: 8px;
    height: 8px;
    top: 0;
    position: absolute;
    top: 0;
    left: -16px;
  }

  .club-content ul {
    list-style: none;
    padding-left: 1.6rem;
  }
  .gift-message-saved.gift-message-saved--sbo p {
    font-weight: 400;
    text-align: left;
    display: block !important;
  }

  .club-content li {
    font-size: 1.8rem;
    font-weight: 100;
    position: relative;
    margin-bottom: 1rem;
  }

  .bottom-content-2 p,
  .bottom-content p {
    font-size: 16px;
    text-align: center;
    margin: 0 auto;
  }
  .back-button {
    color: #9A9B9C;
    margin-right: 1rem;
    font-size: 3rem;
    cursor: pointer;
    position: absolute;
    left: -40px;
    top: -7px
  }
  .subscription-step h2 {
    font-size: 2rem;
    text-align: center;
    position: relative;
    width: fit-content;
    margin: 0 auto;
    margin-bottom: 1rem;
  }
  .bottom-content-2 p b,
  .bottom-content p b {
    font-weight: 900;
  }

  .bottom-content {
    margin: 4rem 0 1rem 0;
    text-align: center;
  }

  .subscription-modal-open {
    overflow: hidden;
  }
  .subscription-step .h2 {
    font-size: 2rem;
    text-align: center;
  }

  .subscription-progress-bar {
    margin-bottom: 1.6rem;
  }
  #subscription-builder-widget {
    padding-bottom: 2rem;
    min-height: 300px;
  }
  #subscription-builder-widget:not(body) {
    margin: 1.6rem;
    overflow: hidden;
  }
  .subscription-builder__steps {
    display: flex;
    flex-wrap: nowrap;
    width: {{100 | times: total_steps}}%;
    transition: all .3s;
  }
  .subscription-step {
    width: 100%;
    padding: 0 4px;
    height: fit-content;
  }
  .subscription-progress-bar {
    display: flex;
    justify-content: space-between;
    position: relative;
  }

  .btn--gift-options {
    cursor: pointer;
  }
  .subscription-progress-bar::after {
    content: "";
    position: absolute;
    height: 4px;
    width: calc(100% - 10px);
    background: #a9dd6166;
    top: 13px;
    left: 5px;
    z-index: 1;
  }

  .select-card input[type=radio],
  .select-card input[type=checkbox] {
    width: 2.4rem;
    height: 2.4rem;
    min-height: auto;
    border: 2px solid #F3576B;
    background: white;
    border-radius: 50px;
    flex-shrink: 0;
  }

  .select-card input[type=radio]:checked,
  .select-card input[type=checkbox]:checked {
    background: #F3576B;
  }

  .select-card__left {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: .8rem;
    min-height: 8rem;
  }

  .select-card.select-card--plan {
    grid-template-columns: 37% auto;
    position: relative;
  }
  .select-card.select-card--plan .select-card__description {
    margin-left: 1.4rem;
  }

  .select-card {
      display: grid;
      border: 0.875px solid rgba(77, 77, 77, 0.19971);
      box-shadow: 0px 2px 4px rgba(77, 77, 77, 0.201868);
      border-radius: 8px;
      margin-bottom: 2.4rem;
      grid-template-columns: minmax(125px, 33%) auto;
  }

  .select-card__left label {
      margin-left: 8px;
      margin-bottom: 0;
      padding-right: 0;
      letter-spacing: 1px;
  }

  .subscription-step.subscription-step--2 .select-card__left label {
    letter-spacing: 0;
  }

  .select-card__description {
    margin-left: 1.8rem;
  }

  .select-card__description .description {
      margin: 0;
      color: #4D4D4D;
      font-size: 14px;
  }

  .select-card__description a {
      color: #919191;
      font-size: 14px;
      font-weight: bold;
  }
  .club-content .club-main-images .slick-slide img{
    height: 350px;
    /* max-height: 350px; */
  }
  .club-content .slick-slide img {
    /* width: 100%; */
    border-radius: 4px;
    /* border: 0.875px solid rgba(77, 77, 77, 0.19971); */
    box-shadow: 0px 2px 4px rgba(77, 77, 77, 0.201868);
    width: 100%;
    object-fit: cover;
  }

  .club-thumbnails {
    margin: 1.8rem 0;
  }
  .club-thumbnails .image {
    /* padding: 4px; */
  }
  .club-thumbnails .image.slick-slide .image__inner {
    border: 3px solid white;
    border-radius: 4px;
    padding: 4px;
  }

  .club-thumbnails .image.slick-slide.slick-current.slick-active .image__inner {
    border: 3px solid #F3576B;
  }

  .club-main-images button.slick-arrow {
    width: 40px;
    height: 40px;
    background-color: rgba(255, 255, 255, 0.5) !important;
    box-shadow: 0px 3px 4px rgba(145, 145, 145, 0.198618);
  }

  .club-main-images .slick-prev {
    left: -8px;
  }

  .club-main-images .slick-next {
    right: -8px;
  }
  .club-thumbnails .slick-track {
    margin: 0;
  }

  .select-card__description p {
    margin: 0;
  }

  .select-card__description p.price {
    font-size: 18px;
    letter-spacing: 0;
  }

  .select-card__description p.price span {
    /* font-weight: 300; */
  }
  .select-card__description div.description {
    font-size: 14px;
    letter-spacing: 1;
  }
  p.savings {
    font-size: 14px;
    color: #F3576B;
    font-weight: 900;
    letter-spacing: 0;
  }
  .select-card__right {
    padding: 14px 0;
  }

  .plan-label {
    position: absolute;
    left: 40%;
    text-transform: uppercase;
    transform: translate(0%, -50%);
    background: #A9DD61;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    letter-spacing: 0.85px;
    z-index: 4;
  }
  .upsell-card {
    display: flex;
    padding: 16px 8px;
    border: 0.875px solid rgba(77, 77, 77, 0.19971);
    box-shadow: 0px 2px 4px rgba(77, 77, 77, 0.201868);
    margin-bottom: 1.6rem;
    border-radius: 7px;
  }

  .upsell-card__image {
    max-width: 80px;
    display: flex;
    align-items: center;
  }

  h4.upsell-card__title {
    font-family: 'KG HAPPY Solid';
    font-style: normal;
    font-weight: 400;
    font-size: 16px;
    line-height: 14px;
    margin-top: 0;
    margin-bottom: 6px;
    line-height: 1.25;
  }

  .upsell-card__content p {
    margin-bottom: 8px;
    margin-top: 3px;
    font-weight: 400;
    font-size: 14px;
    line-height: 18px;
  }

  .upsell-card__title .btn-outline {
    background: white;
  }

  .upsell-card__content .btn.btn-outline {
    background: white;
    color: #f3576b;
    border: 2px solid #f3576b;
    padding: 6px 16px;
    min-width: 130px;
  }

  .upsell-card__content {
    padding-left: 8px;
  }

  .upsell-card__content .quick-add-qty-container, 
  .upsell-card__content .quick-switch-qty-container {
    position: relative;
    left: 0;
    transform: none;
  }

  .upsell-card__content .quick-add-qty {
    margin-left: 0;
    max-width: 120px;
  }
  a.btn.btn-outline.btn--gift-options {
    width: 100%;
    padding: 7px;
    background: white;
    color: #4D4D4D;
    font-weight: 900;
    font-size: 14px;
    line-height: 24px;
    border: 2px solid #F3576B;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .btn--gift-options svg {
    width: 22px;
    margin-right: 8px;
    padding-bottom: 4px;
  }
  .modal-header--gift-options svg {
    width: 23px;
    padding-bottom: 4px;
    margin-right: 6px;
  }

  .modal-header--gift-options  h4 {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .modal-content.modal-content--gift-options h2 {
    font-style: normal;
    font-weight: 400;
    font-size: 16px;
    line-height: 14px;
  }

  .modal-content.modal-content--gift-options p {
    font-style: normal;
    font-weight: 400;
    font-size: 16px;
    line-height: 22px;
    color: #4D4D4D;
  }

  .fields-row {
    display: flex;
    grid-gap: 9px;
    margin-bottom: 2rem;
  }

  .gift-options__parent-details input {
    height: 54px;
  }
  .gift-options__parent-details .input-container {
    width: 100%;
  }
  .gift-options__parent-details textarea {
    padding-top: 16px;
    padding-bottom: 16px;
  }
  .modal-content.modal-content--gift-options,
  .modal-actions {
    padding: 24px 16px;
  }
  .subscription__plans-icons {
    display: flex;
    flex-direction: row;
    grid-gap: 2rem;
    align-items: center;
    justify-content: center;
    text-align: center;
    margin-top: 2.5rem;
  }

  .subscription__plans-icons svg {
    height: 2.75rem;text-align: 
    center;width: 100%;
  }

  .subscription__plans-icons p {
    margin-top: 1rem;
  }

  .modal__close {
    cursor: pointer;
  }

  .button-checkout.loading {
    padding: 0 !important;
  }
  #step-4-summary [role="status"] {
    margin: 1rem;
  }
  .subscription-step--4 .shipping__totals,
  .subscription-step--4 .order__totals {
    display: none;
  }
  .select-card__left {
    position: relative
  }

  .select-card label {
      position: absolute;
      width: 100%;
      left: 0;
      top: 0;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-left: 0;
      text-align: left;
      padding-left: 40px;
  }
  .modal-content.modal-content--gift-options h2.h2 {
    line-height: 1.25 !important;
  }
  #subscription-builder .needsclick {
    display: none !important;
  }
  @media screen and (min-width: 750px) {
    #subscription-builder .needsclick  {
      display: block;
    }
    .select-card__icon {
      width: 40px;
    }
    .club-content .club-main-images .slick-slide img {
      height: 410px;
    }
    .select-card {
      grid-template-columns: 28% 72%;
    }
    .subscription-step {
      padding: 1.6rem 4rem;
    }

    .subscription-progress-bar {
      max-width: 330px;
      margin: 0 auto;
      margin-bottom: 5rem;
      margin-top: 3rem;
    }

    .subscription-step--1 .select-card__description {
      display: flex;
      justify-content: space-between;
      padding-right: 1.5rem;
      align-items: center;
      height: 100%;
      width: 100%;
    }

    .select-card__description .description {
      padding-right: 2rem;
      width: 100%;
      max-width: 170px;
    }

    .subscription-step--2 .select-card__description .description {
      max-width: none;
    }

    .select-card__description a {
      white-space: nowrap;
    }

    .subscription-step > .btn {
      max-width: 350px;
      margin-left: auto !important;
      margin-right: auto !important;
      display: block;
    }

    .additional-content-modal.open {
      max-width: 850px;
      margin: 0 auto;
      position: fixed;
      top: 130px;
      left: 50%;
      transform: translateX(-50%);
      max-height: calc(100vh - 100px);
      border: 0.875px solid rgba(77, 77, 77, 0.19971);
      box-shadow: 0px 2px 4px rgba(77, 77, 77, 0.201868);
      border-radius: 8px;
    }
    div#subscription-builder-widget {
      position: relative;
      overflow: hidden;
      max-width: 550px;
      margin: 0 auto;
      background: #FFFFFF;
    }
    .subscription-progress__container-desktop {
      background: #FFFFFF;
      border: 0.875px solid rgba(77, 77, 77, 0.19971);
      box-shadow: 0px 2px 4px rgb(77 77 77 / 20%);
      border-radius: 8px;
      max-height: none !important;
    }
    .modal-content.modal-content--gift-options, .modal-actions {
      padding: 24px 40px;
      position: relative;
    }
    .modal-actions {
      padding-top: 1rem;
      max-width: 350px;
      margin: 0 auto;
    }
    .additional-content-modal.open {
      height: auto;
    }
    .subscription-modal-open div#shopify-section-header,
    .subscription-modal-open .subscription-progress__container-desktop {
        opacity: 0.3
    }
    .gift-options__parent-details {
      display: flex;
      grid-gap: 8rem;
    }
    .field-column {
      flex: 1;
    }
    .field-column .checkbox-row input {
      min-height: 30px;
    }
    .club-content .club-thumbnails .slick-slide img {
      max-width: 80px;
      width: 100%;
    }
    .additional-content-modal {
      width: auto;
    }
    .club-thumbnails .slick-slide {
      /* width: 80px !important; */
    }
    .club-main-images .slick-slide img {
      /* max-width: 500px; */
      /* margin: 0 auto; */
    }
    .club-thumbnails .slick-track {
      /* width: 100% !important; */
      /* margin: 0 auto; */
    }

    .club-content {
      width: 500px;
    }

    .plan-switch-minus, .plan-switch-plus, .quick-add-qty-minus, .quick-add-qty-plus {
      flex-basis: 40px;
    }
  }
  @media screen and (max-width: 750px) {
    .gift-options__parent-details {
      padding-bottom: 7rem;;
    }
    .subscription-modal-open [class*="kl-private-reset"] {
      display: none;
    }
    .subscription-modal-open iframe {
      display: none !important;
    }
  }
  .subscription-step--4 .btn.btn--add-to-cart.button-checkout {
    display: none;
  }

  .subscription-step--4.needsreview .btn.btn--add-to-cart.button-checkout {
    display: block;
    min-height: 54px;
    font-weight: 10;
  }
  .subscription-step--4.needsreview #checkout {
    display: none;
  }
  .subscription-step--4.needsreview #step-4-buttons {
    height: 20px;
  }
</style>



{% schema %}
{
  "name": "Subscription Builder",
  "class": "very-top",
  "settings": [
    {
      "type": "select",
      "id": "autoselected_club",
      "label": "Autoselected Club",
      "default": "none",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "C",
          "label": "Cooking"
        },
        {
          "value": "B",
          "label": "Baking"
        },
        {
          "value": "G",
          "label": "Global"
        }
      ]
    },
    {
      "type": "collection",
      "id": "plans_collection",
      "label": "Plans"
    },
    {
      "type": "image_picker",
      "id": "sibling_bundle_image",
      "label": "Sibling Bundle Image"
    },
    {
      "type": "text",
      "id": "sibling_bundle_title",
      "label": "Sibling Bundle Title",
      "default": "Sibling Bundle ($5/mo)"
    },
    {
      "type": "textarea",
      "id": "sibling_bundle_description",
      "label": "Sibling Bundle Title",
      "default": "Add a sibling tool and patch to each kit. Paid upfront."
    },
    {
      "type": "richtext",
      "id": "shipping_copy",
      "label": "Shipping copy",
      "default": "<p> <b> Free </b> US Shipping! Internation $7/mo.</p>"
    },
    {
      "type": "richtext",
      "id": "autorenew_copy",
      "label": "Autorenew copy",
      "default": "<p>Plans auto-renew, <b>cancel anytime.</b></p>"
    },
    {
      "type": "number",
      "id": "max_siblings",
      "label": "Max No of Sibling Bundles",
      "default": 2
    }
  ],
  "presets": [
    {
      "name": "Subscription Builder",
      "category": "Subscription"
    }
  ],  
  "blocks": [
    {
      "type": "steps",
      "name": "Steps",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "Step 1"
        },
        {
          "type": "text",
          "id": "step_1_short_title",
          "label": "Short title",
          "default": "Club"
        },
        {
          "type": "text",
          "id": "step_1_title",
          "label": "Title",
          "default": "Choose Your Club"
        },
        {
          "type": "textarea",
          "id": "step_1_bottom_description",
          "label": "Bottom Description",
          "default": "<p><b>Bonus:</b> all clubs include access to <a href='#'>Raddish+</a>, our digital library</p>"
        },
        {
          "type": "text",
          "id": "step_1_bottom_description_modal_id",
          "label": "Raddish+ modal section id"
        },
        {
          "type": "header",
          "content": "Step 2"
        },
        {
          "type": "text",
          "id": "step_2_short_title",
          "label": "Short Title",
          "default": "Term"
        },
        {
          "type": "text",
          "id": "step_2_title",
          "label": "Title",
          "default": "Pick Your Plan"
        },
        {
          "type": "textarea",
          "id": "step_2_desc",
          "label": "Description"
        },
        {
          "type": "header",
          "content": "Step 3"
        },
        {
          "type": "text",
          "id": "step_3_short_title",
          "label": "Short Title",
          "default": "Customize"
        },
        {
          "type": "text",
          "id": "step_3_title",
          "label": "Title",
          "default": "Customize Your Kit"
        },
        {
          "type": "checkbox",
          "id": "step_3_enable_buy_now",
          "label": "Enable buy now ship later",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "step_3_enable_ship_december",
          "label": "Enable ship December",
          "default": false
        },
        {
          "type": "text",
          "id": "step_3_ship_december_copy",
          "label": "Ship December copy",
          "default": "I want to ship my kit in December"
        },
        {
          "type": "checkbox",
          "id": "step_3_enable_ship_january",
          "label": "Enable ship January",
          "default": false
        },
        {
          "type": "text",
          "id": "step_3_ship_january_copy",
          "label": "Ship January copy",
          "default": "I want to ship my kit in January"
        },
        {
          "type": "text",
          "id": "step_3_buy_ship_later_title",
          "label": "Buy Now, Ship Later Title",
          "default": "3. Buy Now, Ship Later"
        },
        {   
          "type": "text",
          "id": "step_3_gift_options_button_label",
          "label": "Gift Options Button Label",
          "default": "Gift Options"
        },
        {   
          "type": "text",
          "id": "step_3_review_order_button_label",
          "label": "Review Order Button Label",
          "default": "Review Your Order"
        },
        {
          "type": "header",
          "content": "Step 4"
        },
        {
          "type": "text",
          "id": "step_4_short_title",
          "label": "Short Title",
          "default": "Review"
        },
        {
          "type": "text",
          "id": "step_4_title",
          "label": "Title",
          "default": "Review Your Order"
        },
        {
          "type": "checkbox",
          "default": false,
          "label": "Enable BNSL edit on step 4",
          "id": "enable_bnsl_edit"
        },
        {
          "type": "text",
          "id": "step_4_buy_ship_later_label",
          "label": "Buy Now Ship Later Label",
          "default": "Buy Now Ship Later:"
        },
        {
          "type": "text",
          "id": "step_4_buy_ship_now_text",
          "label": "Ship Now Text",
          "default": "Ship Now"
        },
        {
          "type": "text",
          "id": "step_4_buy_ship_later_text_january",
          "label": "Buy Now Ship Later Text Jan",
          "default": "First will arrive in January"
        },
        {
          "type": "text",
          "id": "step_4_buy_ship_later_text_december",
          "label": "Buy Now Ship Later Text Dec",
          "default": "First will arrive in December"
        },
        {
          "type": "text",
          "id": "step_4_sbo_text",
          "label": "SBO Text",
          "default": "Start Date: Your first order will process on the 20th or following business day."
        },
        {
          "type": "text",
          "id": "step_4_gifts_label",
          "label": "Gifts email label",
          "default": "Giftee's email address:"
        }
      ]
    },
    {
      "type": "club",
      "name": "Club",
      "limit": 5,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Subscription Product",
          "info": "No sibling bundles"
        },
        {
          "type": "checkbox",
          "id": "sbo_enabled",
          "label": "SBO Enabled",
          "default": false
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "textarea",
          "id": "svg_icon",
          "label": "SVG Icon"
        },
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon"
        },
        {
          "type": "color",
          "id": "color",
          "label": "Color"
        },
        {
          "type": "text",
          "id": "section_id",
          "label": "Section ID",
          "info": "This section is going to be inserted into View Details modal"
        }
      ]
    },
    {
      "type": "plan",
      "name": "Plan",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "number",
          "id": "length",
          "label": "Length"
        },
        {
          "type": "html",
          "id": "price",
          "label": "Price"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "free_item_title",
          "label": "Free item title"
        },
        {
          "type": "text",
          "id": "free_item_2_title",
          "label": "Free item 2 title"
        },
        {
          "type": "text",
          "id": "free_item_3_title",
          "label": "Free item 3 title"
        },
        {
          "type": "textarea",
          "id": "savings",
          "label": "Save text"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label"
        }
      ]
    },
    {
      "type": "upsells",
      "name": "Upsells",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "upsell_title",
          "label": "Title"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description"
        }
      ]
    }
  ]
}
{% endschema %}