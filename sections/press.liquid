{%- assign _section = section.settings -%}
{%- assign section_featured_title = _section.featured_title -%}
{%- assign section_featured_article = articles[_section.featured_article] -%}
{%- assign section_content = _section.content -%}
{%- assign section_link_text = _section.link_text -%}
{%- assign section_link_url = _section.link_url -%}
{%- assign section_hide_view_more = _section.hide_view_more -%}

<div class="page-width page-width--larger">
  <div class="featured-section">
    {%- if section_featured_title != blank -%}
      <h3>{{section_featured_title}}</h3>
    {%- endif -%}
    <div class="flex">
      <div class="left-side">
        {%- if _section.featured_article -%}
          <div class="article-row">
            {%- include 'press-article', article: section_featured_article -%}
          </div><!-- /.article-row -->
        {%- endif -%}
      </div><!-- /.left-side -->
      <div class="right-side">
        <div class="intro-box">
          {{section_content}}
          {%- if section_link_url != blank and section_link_text != blank -%}
            <a href="{{section_link_url}}" class="download-icon" target="_blank">{{section_link_text}}</a>
          {%- endif -%}
        </div><!-- /.intro-box -->
      </div><!-- /.right-side -->
    </div><!-- /.flex -->
  </div><!-- /.featured-section -->

    <div class="flex press-listing">
      <div class="left-side">
        <h3>{{ 'blogs.press.recent_title' | t }}</h3>
        {%- for article in blog.articles -%}
          <div class="article-row">
            <div class="flex">
              {%- include 'press-article', article: article -%}
            </div><!-- /.flex -->
          </div><!-- /.article-row -->
        {%- endfor -%}
      </div><!-- /.left-side -->
      <div class="right-side">
        {%- for block in section.blocks -%}
          {%- assign _block = block.settings -%}
          {%- assign block_title = _block.title -%}
          {%- assign block_video_embed = _block.video_embed -%}
          {%- assign block_show_widget = _block.show_widget -%}

          {% if block_show_widget %}  
            <div class="widget widget--{{block.type}}">
              {%- if block_title != blank -%}
                <h3>{{block_title}}</h3>
              {%- endif -%}
              {%- case block.type -%}
                {% when "video" %}
                  {%- assign block_image = _block.image -%}
                  {%- assign block_article_title = _block.article_title -%}
                  {%- assign block_date = _block.date -%}
                  {%- assign block_link = _block.link -%}
                  {%- assign block_video_link = _block.video_link -%}

                  <div class="video_embed">
                    {{ block_video_embed }}
                  </div><!-- /.video_embed -->
                  {%- if block_date != blank -%}
                    <h6>{{block_date}}</h6>
                  {%- endif -%}
                  <h4>
                  {% if block_link != blank %}
                    <a href="{{block_link}}">
                  {% endif %}
                      {{block_article_title}}
                  {% if block_link != blank %}
                    </a>
                  {% endif %}
                  </h4>
                {% when "recent" %}
                  {%- assign block_recent = _block.recent -%}
                  {%- assign block_show_posts = _block.show_posts -%}
                  <ul>
                    {%- for _article in blogs[block_recent].articles limit: block_show_posts -%}
                      {%- assign excerpt = _article.excerpt | strip_html -%}
                      <li>
                        {% assign article_date =  _article.created_at | date: '%B %d, %Y' %}
                        <h6>{{ _article.metafields['article']['date'] | default: article_date }}</h6>
                        <h4>
                          <a href="{{ excerpt | default: _article.url }}" target="_blank">
                            {{ _article.title }}
                          </a>
                        </h4>
                      </li> 
                    {%- endfor -%}
                  </ul>
                {% when "award" %}
                  {%- assign block_image = _block.image -%}
                  {% include 'image', _image: block_image, size: '600', alt: block_image.alt %}
              {%- endcase -%}
            </div><!-- /.widget -->
          {% endif %}
        {%- endfor -%}
      </div><!-- /.right-side -->
    </div><!-- /.flex -->
    
</div><!-- /.page-width -->

{% schema %}
{
  "name": "Press",
  "class": "press-wrapper",
  "settings": [
    {
      "type": "text",
      "id": "featured_title",
      "label": "Featured Title"
    },
    {
      "type": "article",
      "id": "featured_article",
      "label": "Featured Article"
    },
    {
      "type": "header",
      "content": "Info Box"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Content"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Link Text"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "checkbox",
      "id": "hide_view_more",
      "label": "Hide View More",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_widget",
          "label": "Show Widget",
          "default": true
        },
        {
          "type": "text",
          "id": "title",
          "label": "Widget Title"
        },
        {
          "type": "text",
          "id": "date",
          "label": "Date"
        },
        {
          "type": "text",
          "id": "article_title",
          "label": "Title"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "html",
          "id": "video_embed",
          "label": "Video Embed"
        }
      ]
    },
    {
      "type": "recent",
      "name": "Recent",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_widget",
          "label": "Show Widget",
          "default": true
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "blog",
          "id": "recent",
          "label": "Choose Blog"
        },
        {
          "type": "range",
          "id": "show_posts",
          "min": 2,
          "max": 10,
          "step": 1,
          "label": "How many posts",
          "default": 4
        }
      ]
    },
    {
      "type": "award",
      "name": "Award",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_widget",
          "label": "Show Widget",
          "default": true
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ]
}
{% endschema %}
