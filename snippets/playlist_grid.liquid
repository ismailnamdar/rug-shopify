{%- assign designData = shop.metafields.reelUp.playlistgrid_widget_design.value -%}
{%- assign reelUpVideos = shop.metafields.reelUp.reels.value -%}
{%- assign reelUpSettings = shop.metafields.reelUp.settings.value -%}
{%- assign desktopWidth = designData.grid_rows_desktop | append: '.0' -%}
{%- assign mobileWidth = designData.grid_rows_mobile | append: '.0' -%}
{%- assign desktopCardWidth = 100 | divided_by: desktopWidth -%}
{%- assign mobileCardWidth = 100 | divided_by: mobileWidth -%}
{%- assign cardsGap = designData.grid_reels_gap | append: '.0' | divided_by: 2 -%}
{%- assign gap = designData.grid_reels_gap -%}

{%- comment %} Use sorted reels if available, otherwise use original playlist reels {% endcomment -%}
{%- if sortedReels and sortedReels.size > 0 -%}
  {%- assign reelsToUse = sortedReels -%}
{%- else -%}
  {%- assign reelsToUse = playlistData.reels -%}
{%- endif -%}

<div class="reelUp_playlist_grid_static reelUp_carousel reelUp_playlist_loading reelUp_grid reelUp_grid_view" id="reelUp_playlist_{{ playlistData.id }}" data-playlist-id="{{ playlistData.id }}" style="max-width: {% if designData.wrapper_width == "full_width" %} 100% {% else %}{{ designData.playlist_wrapper_width | append: "px" }}{% endif %}">
  {%- assign showHeading = true -%}
  {%- if designData.show_playlist_heading -%}
    {%- assign showHeading = designData.show_playlist_heading -%}
  {%- endif -%}
  {%- if showHeading == true or showHeading == 1 -%}
    <div class="reelUp_grid_heading" style="color: {{ designData.playlist_heading_color }}; font-size: {{ designData.playlist_heading_font_size }}px; font-weight:{{ designData.playlist_heading_font_weight }}; opacity: 0; margin-bottom:10px; text-align:{{ designData.playlist_heading_alignment }}">{{ playlistData.title }} </div>
  {%- endif -%}
  <div class="reelUp_grid_wrapper reelUp_{{ playlistData.widget_template }}_template {% if designData.playlist_button == 1 %} reelup_atc_fixed {% endif %}">
    {%- for reel in reelsToUse -%}
    {% assign reel_number = reel | times: 1 %}
      {%- for reelData in reelUpVideos -%}
        {%- if reelData.id == reel_number -%}
          <div class="reelUp_slide reelUp_grid_item" data-reel-id="{{ reelData.id }}" data-product-id="{% if reelData.products.size > 0 %}{{ reelData.products[0].id }}{% else %}null{% endif %}" data-product-handle="{% if reelData.products.size > 0 %}{{ reelData.products[0].handle }}{% else %}null{% endif %}">
            <div class="reelUp_card_skeleton reelUp_card reelUp_card_playlist_reels {% if reelData.products.size == 0 %} reelUp_card_video_only_video {% endif %}" style="margin: {{ cardsGap }}px">
              <div class="reelUp_card_video_wrapper" style="padding-bottom: {% if reelData.products.size == 0 or playlistData.widget_template != 'classic' %} 177.5%; {% elsif reelUpSettings.integrations.reviews.reviews_provider != null %} calc(177.5% + 120px); {% elsif designData.playlist_button == 1 or playlistData.widget_template != 'classic' %} calc(177.5% + 50px) {% else %} calc(177.5% + 110px) {% endif %}"></div>
            </div>
          </div>
        {%- endif -%}
      {%- endfor -%}
    {%- endfor -%}
  </div>
</div>
<style>
  #reelUp_playlist_{{ playlistData.id }} .reelUp_slide { 
    width: {{ desktopCardWidth }}%;  
  }
  
  @media only screen and (max-width: 767px) { 
    #reelUp_playlist_{{ playlistData.id }} .reelUp_slide { 
      width: {{ mobileCardWidth }}%;
    } 
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  if(!window.REELUP){
  const __wrappers = document.querySelectorAll(".reelUp_playlist_grid_static.reelUp_carousel");
      if (__wrappers.length != 0) {
          __wrappers.forEach(sel => {
              sel.remove();
              console.log("REELUP WRAPPER IS REMOVED");
          })
      }
  }
});
</script>

<link href="{{ 'reels_grid.css' | asset_url }}" rel="preload stylesheet" as="style">