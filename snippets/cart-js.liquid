{% comment %} <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/shopify-cartjs/0.4.1/rivets-cart.min.js"></script> {% endcomment %}

{%- comment -%}

<script type="text/javascript">

var $skip_cart_update = false;
var $active_plan = false;


$(document).ready(function(){
  gift_check();
  active_plan();
  $(document).on('cart.requestComplete', function(event, cart) {
    active_plan();
    if($skip_cart_update == false) {
      gift_check();
    }
    else {
      $skip_cart_update = false;
    }
  });
});

function gift_check() {
  $.getJSON('/cart.js', function(cart) {
    var $cart_has_plan = false;
    for (i = 0; i < CartJS.cart.items.length; i++) {
      if(CartJS.cart.items[i].properties.plan ) {
        $cart_has_plan = true;
        step1_filled = true;
      }
    }
    for (j = 0; j < CartJS.cart.items.length; j++) {
      if(CartJS.cart.items[j].properties._gift_product == "Free Apron") {
        $skip_cart_update = true;
          
        if ($cart_has_plan == false) {
          CartJS.updateItemById(CartJS.cart.items[j].id, 0);
          $(document).on('cart.requestComplete', function(event, cart) {
            location.reload();
          });

          //$('.js-giftProduct').hide();
          
        }
        
      }
    }
  });
}

function active_plan() {
  for (i = 0; i < CartJS.cart.items.length; i++) {
    if(CartJS.cart.items[i].properties.plan ) {
      $active_plan = CartJS.cart.items[i].properties.plan;
      $active_plan_id = CartJS.cart.items[i].id;
    }
  }
  if($active_plan != false) {
    select_membership($active_plan);
    active_siblings();
    $(".step-2-trigger").removeClass("disabled").text("Next");
  }
}

function select_membership($active_plan) {
  var container = '.bw-plan-' + $active_plan,
      plan_button = '.bw-plan-' + $active_plan + ' .bw-plan-atc',
      mobile_selector = '.bw-step-picker-step[plan="' + $active_plan + '"]';

  // Clears selected states from Plans, adds selected state to currently active Plan - Desktop and Mobile
  $('.bw-plan').removeClass('plan-selected');
  $('.bw-plan-atc').removeAttr('disabled');
  $(container).addClass('plan-selected');
  $('.bw-step-picker-step').removeClass('plan-selected');
  $(mobile_selector).addClass('plan-selected');

  $(plan_button).attr('disabled', 'disabled');

  $('.bw-step1-header').addClass('bw-filled');
  $('.bw-step2-header, .bw-step3-header').addClass('bw-ready');
  step1_filled = true;
}

function active_siblings() {
  for (j = 0; j < $plans.length; j++) {
    if($plans[j].prod_id_siblings_0 == $active_plan_id) {
      $active_siblings = 0;
    }
    else if ($plans[j].prod_id_siblings_1 == $active_plan_id) {
      $active_siblings = 1;
    }
    else if ($plans[j].prod_id_siblings_2 == $active_plan_id) {
      $active_siblings = 2;
    }
    else if ($plans[j].prod_id_siblings_3 == $active_plan_id) {
      $active_siblings = 3;
    }
  }
  $('.plan-switch-qty-display').text($active_siblings);
  if($active_siblings == 0) {
    $('.quick-switch-container').removeClass('added');
  }
  else if($active_siblings >= 3) {
    $('.quick-switch-container').addClass('added');
    $('.quick-switch-container').addClass('max');
  }
  else {
    $('.quick-switch-container').addClass('added');
  }
}


</script>
{%- endcomment -%}